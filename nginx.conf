
events {
  worker_connections  4096;  ## Default: 1024
}

http {
  server {
      listen 80 default_server;
      listen [::]:80 default_server;
      # 
      server_name codi15.dyndns.org;
      #
      location / {
	  # match everything
	  rewrite ^\/(.*)$ /$1 break;
	  # Proxy passing to port 4000
	  proxy_pass https://codi15.dyndns.org:4000;
	  #
	  #Give larger upstream buffers
	  fastcgi_buffers 16 16k;
	  fastcgi_buffer_size 32k;
	  proxy_buffer_size 128k;
	  proxy_buffers 4 256k;
	  proxy_busy_buffers_size 256k;
      }
  }

  server {
      server_name codi15.dyndns.org;
      #
      location / {
	  #match everything
	  rewrite ^\/(.*)$ /$1 break;
	  # Proxy passing to port 4000
	  proxy_pass https://codi15.dyndns.org:4000;
	  #
	  #Give larger upstream buffers
	  fastcgi_buffers 16 16k;
	  fastcgi_buffer_size 32k;
	  proxy_buffer_size 128k;
	  proxy_buffers 4 256k;
	  proxy_busy_buffers_size 256k;
      }
      #
      listen [::]:443 ssl ipv6only=on; # managed by Certbot
      listen 443 ssl; # managed by Certbot
      ssl_certificate /etc/letsencrypt/live/codi15.dyndns.org/fullchain.pem; # managed by Certbot
      ssl_certificate_key /etc/letsencrypt/live/codi15.dyndns.org/privkey.pem; # managed by Certbot
      include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
      ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
  }

}
